# 前端测试指南

## 目录

- [测试环境准备](#测试环境准备)
- [手动测试流程](#手动测试流程)
- [自动化测试](#自动化测试)
- [测试数据准备](#测试数据准备)
- [常见问题排查](#常见问题排查)

---

## 测试环境准备

### 1. 启动后端服务

```bash
cd backend
python -m app.main
```

后端服务将在 `http://localhost:12801` 启动。

### 2. 启动前端开发服务器

```bash
cd frontend
npm run dev
```

前端服务将在 `http://localhost:12800` 启动。

### 3. 环境检查清单

- [ ] 后端服务运行正常（访问 http://localhost:12801/docs）
- [ ] 前端服务运行正常（访问 http://localhost:12800）
- [ ] 数据库连接正常
- [ ] 浏览器控制台无错误
- [ ] API 请求响应正常

---

## 手动测试流程

### 测试策略

本指南采用**功能模块化测试**方法，按照以下顺序进行：

1. **基础功能测试** - 确保系统核心功能可用
2. **CRUD 操作测试** - 创建、读取、更新、删除
3. **交互测试** - 用户界面交互流程
4. **边界条件测试** - 异常情况和边界值
5. **跨页面流程测试** - 完整用户场景

---

## 一、仪表板（Dashboard）测试

### 测试入口
访问 `http://localhost:12800/`

### 1.1 统计卡片测试

| 测试项 | 操作 | 预期结果 | 状态 |
|--------|------|----------|------|
| 显示统计卡片 | 页面加载 | 显示4个统计卡片 | ⬜ |
| 房间数正确 | 初始状态 | 显示 0（无数据时） | ⬜ |
| 植物数正确 | 初始状态 | 显示 0（无数据时） | ⬜ |
| 今日任务正确 | 初始状态 | 显示 0（无数据时） | ⬜ |
| 逾期任务正确 | 初始状态 | 显示 0（无数据时） | ⬜ |
| 点击卡片跳转 | 点击统计卡片 | 跳转到对应页面 | ⬜ |

### 1.2 今日任务列表测试

| 测试项 | 操作 | 预期结果 | 状态 |
|--------|------|----------|------|
| 空状态显示 | 无任务时 | 显示"今日暂无任务" | ⬜ |
| 加载状态 | 刷新页面 | 显示加载动画 | ⬜ |
| 任务列表显示 | 有任务时 | 显示任务列表（最多5条） | ⬜ |
| 查看全部链接 | 点击"查看全部" | 跳转到任务页面 | ⬜ |

### 1.3 快速开始区域测试

| 测试项 | 操作 | 预期结果 | 状态 |
|--------|------|----------|------|
| 管理房间按钮 | 点击 | 跳转到 /rooms | ⬜ |
| 管理植物按钮 | 点击 | 跳转到 /plants | ⬜ |
| 查看任务按钮 | 点击 | 跳转到 /tasks | ⬜ |

### 1.4 系统状态区域测试

| 测试项 | 预期结果 | 状态 |
|--------|----------|------|
| 显示后端服务状态 | ✅ 后端服务运行中 | ⬜ |
| 显示数据库状态 | ✅ 数据库连接正常 | ⬜ |
| API文档链接 | 可点击且有效 | ⬜ |

---

## 二、房间（Rooms）页面测试

### 测试入口
访问 `http://localhost:12800/rooms`

### 2.1 房间列表功能测试

| 测试项 | 操作 | 预期结果 | 状态 |
|--------|------|----------|------|
| 空状态显示 | 无房间时 | 显示"还没有房间，创建第一个房间吧！" | ⬜ |
| 添加房间按钮 | 点击 | 打开房间表单模态框 | ⬜ |
| 刷新按钮 | 点击 | 重新加载房间列表 | ⬜ |
| 位置类型筛选 | 选择筛选器 | 过滤显示的房间 | ⬜ |

### 2.2 创建房间测试

| 测试项 | 操作 | 预期结果 | 状态 |
|--------|------|----------|------|
| 打开创建表单 | 点击"添加房间" | 表单为空，默认选中"室内" | ⬜ |
| 表单验证 - 必填项 | 不填名称直接提交 | 显示"请输入房间名称"错误 | ⬜ |
| 创建房间 - 完整信息 | 填写完整信息 | 成功创建，显示成功提示 | ⬜ |
| 创建后列表更新 | 创建成功后 | 新房间出现在列表中 | ⬜ |
| 创建后关闭模态框 | 创建成功后 | 模态框自动关闭 | ⬜ |

**测试数据示例：**
```
房间名称: 客厅
描述: 阳光充足的客厅
位置类型: 室内
图标: 🛋️
颜色: #1890ff
```

### 2.3 编辑房间测试

| 测试项 | 操作 | 预期结果 | 状态 |
|--------|------|----------|------|
| 打开编辑表单 | 点击房间卡片"编辑" | 表单预填充现有数据 | ⬜ |
| 修改房间信息 | 更新描述等 | 更新成功，显示成功提示 | ⬜ |
| 更新后列表刷新 | 更新成功后 | 列表显示更新后的数据 | ⬜ |
| 取消编辑 | 点击"取消"按钮 | 模态框关闭，数据不变 | ⬜ |

### 2.4 删除房间测试

| 测试项 | 操作 | 预期结果 | 状态 |
|--------|------|----------|------|
| 删除确认对话框 | 点击"删除"按钮 | 显示确认对话框 | ⬜ |
| 确认删除 | 点击"确定" | 房间被删除，显示成功提示 | ⬜ |
| 取消删除 | 点击"取消"按钮 | 对话框关闭，房间保留 | ⬜ |
| 删除后列表更新 | 删除成功后 | 房间从列表中消失 | ⬜ |

### 2.5 房间卡片显示测试

| 测试项 | 预期结果 | 状态 |
|--------|----------|------|
| 显示房间图标和名称 | ✅ | ⬜ |
| 显示位置类型标签 | 正确的颜色和文本 | ⬜ |
| 显示描述 | 有描述时显示 | ⬜ |
| 显示植物数量 | 正确统计 | ⬜ |
| 查看植物按钮 | 跳转到植物页面并筛选 | ⬜ |
| 编辑按钮 | 打开编辑表单 | ⬜ |
| 删除按钮 | 显示确认对话框 | ⬜ |

### 2.6 筛选功能测试

| 测试项 | 操作 | 预期结果 | 状态 |
|--------|------|----------|------|
| 筛选室内房间 | 选择"室内" | 只显示位置类型为室内的房间 | ⬜ |
| 筛选室外房间 | 选择"室外" | 只显示位置类型为室外的房间 | ⬜ |
| 显示全部 | 选择"全部" | 显示所有房间 | ⬜ |

---

## 三、植物（Plants）页面测试

### 测试入口
访问 `http://localhost:12800/plants`

### 3.1 植物列表功能测试

| 测试项 | 操作 | 预期结果 | 状态 |
|--------|------|----------|------|
| 空状态显示 | 无植物时 | 显示"还没有植物，添加第一株植物吧！" | ⬜ |
| 添加植物按钮 | 点击 | 打开植物表单模态框 | ⬜ |
| 刷新按钮 | 点击 | 重新加载植物列表 | ⬜ |
| 搜索框 | 输入关键词 | 实时筛选植物名称 | ⬜ |
| 房间筛选器 | 选择房间 | 筛选指定房间的植物 | ⬜ |
| 健康状态筛选 | 选择状态 | 筛选指定健康状态的植物 | ⬜ |
| 清除筛选 | 点击"清除筛选" | 重置所有筛选条件 | ⬜ |

### 3.2 创建植物测试

| 测试项 | 操作 | 预期结果 | 状态 |
|--------|------|----------|------|
| 打开创建表单 | 点击"添加植物" | 表单为空 | ⬜ |
| 房间选项显示 | 查看房间下拉框 | 显示所有可用房间 | ⬜ |
| 无房间时提示 | 无房间创建植物 | 显示"暂无房间，请先创建房间" | ⬜ |
| 表单验证 - 必填项 | 不填名称和房间 | 显示验证错误 | ⬜ |
| 创建植物 - 完整信息 | 填写完整信息 | 成功创建，显示成功提示 | ⬜ |
| 创建后列表更新 | 创建成功后 | 新植物出现在列表中 | ⬜ |

**测试数据示例：**
```
植物名称: 龟背竹
学名: Monstera deliciosa
描述: 喜欢温暖潮湿的环境
房间: 客厅
购买日期: 2024-01-15
健康状态: 健康
```

### 3.3 编辑植物测试

| 测试项 | 操作 | 预期结果 | 状态 |
|--------|------|----------|------|
| 打开编辑表单 | 点击"编辑" | 表单预填充现有数据 | ⬜ |
| 修改健康状态 | 更改为"需要关注" | 更新成功 | ⬜ |
| 修改房间 | 更换房间 | 更新成功 | ⬜ |
| 更新后显示 | 更新成功后 | 植物卡片显示新数据 | ⬜ |

### 3.4 删除植物测试

| 测试项 | 操作 | 预期结果 | 状态 |
|--------|------|----------|------|
| 删除确认 | 点击"删除" | 显示确认对话框 | ⬜ |
| 确认删除 | 点击"确定" | 植物被删除 | ⬜ |
| 删除提示信息 | 确认对话框内容 | 提示"相关的图片和配置也将被删除" | ⬜ |

### 3.5 植物卡片显示测试

| 测试项 | 预期结果 | 状态 |
|--------|----------|------|
| 显示主图 | 有图片时显示主图 | ⬜ |
| 无图片时默认图标 | 无图片时显示 🌱 | ⬜ |
| 健康状态徽章 | 颜色和文本正确 | ⬜ |
| 显示植物名称 | 正确显示 | ⬜ |
| 显示学名 | 有学名时显示（斜体） | ⬜ |
| 显示房间信息 | 正确显示所属房间 | ⬜ |
| 显示购买日期 | 格式化为 YYYY-MM-DD | ⬜ |
| 显示图片数量 | 正确统计 | ⬜ |
| 养护按钮 | 打开图片管理模态框 | ⬜ |

### 3.6 筛选功能测试

| 测试项 | 操作 | 预期结果 | 状态 |
|--------|------|----------|------|
| 搜索植物名称 | 输入"龟背竹" | 只显示名称包含"龟背竹"的植物 | ⬜ |
| 筛选房间 | 选择"客厅" | 只显示客厅的植物 | ⬜ |
| 筛选健康状态 | 选择"需要关注" | 只显示需要关注的植物 | ⬜ |
| 组合筛选 | 搜索+房间+状态 | 同时应用多个筛选条件 | ⬜ |
| 筛选标签显示 | 有筛选条件时 | 显示当前筛选条件标签 | ⬜ |
| 点击标签移除 | 点击筛选标签 | 移除对应筛选条件 | ⬜ |

### 3.7 图片管理测试

| 测试项 | 操作 | 预期结果 | 状态 |
|--------|------|----------|------|
| 打开图片管理 | 点击"养护"按钮 | 打开图片管理模态框 | ⬜ |
| 图片列表显示 | 有图片时 | 显示所有图片（网格布局） | ⬜ |
| 主图标识 | 主图显示金色标签 | ⬜ |
| 添加图片 - URL | 输入URL并提交 | 图片添加成功 | ⬜ |
| 添加图片 - 文件 | 上传本地文件 | 图片上传成功 | ⬜ |
| 设置主图 | 点击"设为主图" | 该图片成为主图，其他取消 | ⬜ |
| 删除图片 | 点击"删除" | 图片被删除 | ⬜ |
| 主图保护 | 删除唯一的主图 | 提示"主图不能删除" | ⬜ |

---

## 四、任务（Tasks）页面测试

### 测试入口
访问 `http://localhost:12800/tasks`

### 4.1 任务统计测试

| 测试项 | 预期结果 | 状态 |
|--------|----------|------|
| 今日任务数量 | 显示正确的数量 | ⬜ |
| 即将到期数量 | 显示正确的数量 | ⬜ |
| 逾期任务数量 | 显示正确的数量（红色警告） | ⬜ |

### 4.2 任务列表测试

| 测试项 | 操作 | 预期结果 | 状态 |
|--------|------|----------|------|
| 今日任务标签 | 点击 | 显示今日任务列表 | ⬜ |
| 即将到期标签 | 点击 | 显示即将到期任务 | ⬜ |
| 逾期任务标签 | 点击 | 显示逾期任务 | ⬜ |
| 任务列表显示 | 切换标签 | 正确显示对应任务 | ⬜ |
| 空状态 | 无任务时 | 显示"暂无任务" | ⬜ |
| 任务项显示 | 有任务时 | 显示任务详情 | ⬜ |

### 4.3 任务项显示测试

| 测试项 | 预期结果 | 状态 |
|--------|----------|------|
| 任务类型标签 | 正确的颜色和文本 | ⬜ |
| 植物名称 | 正确显示 | ⬜ |
| 植物图片 | 显示植物主图 | ⬜ |
| 到期时间 | 显示日期和相对时间 | ⬜ |
| 紧急程度指示 | 逾期/今日/即将到期有不同颜色 | ⬜ |
| 进度条 | 显示任务紧急程度 | ⬜ |
| 完成按钮 | 点击可完成任务 | ⬜ |

### 4.4 完成任务测试

| 测试项 | 操作 | 预期结果 | 状态 |
|--------|------|----------|------|
| 完成确认 | 点击"完成" | 显示确认对话框 | ⬜ |
| 确认完成 | 点击"确定" | 任务状态更新为已完成 | ⬜ |
| 完成后列表更新 | 完成成功后 | 任务从列表中消失 | ⬜ |
| 取消完成 | 点击"取消" | 任务保留，状态不变 | ⬜ |

---

## 五、导航和布局测试

### 5.1 侧边栏导航测试

| 测试项 | 操作 | 预期结果 | 状态 |
|--------|------|----------|------|
| 仪表板导航 | 点击"仪表板" | 跳转到首页 | ⬜ |
| 房间导航 | 点击"房间" | 跳转到房间页面 | ⬜ |
| 植物导航 | 点击"植物" | 跳转到植物页面 | ⬜ |
| 任务导航 | 点击"任务" | 跳转到任务页面 | ⬜ |
| 当前页面高亮 | 查看导航菜单 | 当前页面对应菜单项高亮 | ⬜ |

### 5.2 响应式布局测试

| 测试项 | 操作 | 预期结果 | 状态 |
|--------|------|----------|------|
| 桌面显示 | 1920x1080 | 2-3列布局 | ⬜ |
| 平板显示 | 768x1024 | 适应平板布局 | ⬜ |
| 手机显示 | 375x667 | 单列布局 | ⬜ |
| 侧边栏响应式 | 缩小窗口 | 侧边栏可折叠 | ⬜ |

---

## 六、边界条件和错误处理测试

### 6.1 网络错误测试

| 测试项 | 操作 | 预期结果 | 状态 |
|--------|------|----------|------|
| 后端服务关闭 | 停止后端服务 | 显示错误提示 | ⬜ |
| API 请求失败 | 触发API调用 | 显示友好的错误消息 | ⬜ |
| 加载状态 | 等待响应 | 显示加载指示器 | ⬜ |
| 重试机制 | 错误后重试 | 可以重新加载数据 | ⬜ |

### 6.2 表单验证测试

| 测试项 | 操作 | 预期结果 | 状态 |
|--------|------|----------|------|
| 必填字段验证 | 提交空表单 | 显示验证错误 | ⬜ |
| 长度限制 | 输入超长文本 | 显示长度限制错误 | ⬜ |
| 格式验证 | 输入错误格式 | 显示格式错误 | ⬜ |
| 实时验证 | 输入时 | 实时显示验证状态 | ⬜ |

### 6.3 数据为空测试

| 测试项 | 预期结果 | 状态 |
|--------|----------|------|
| 无房间时 | 显示引导提示 | ⬜ |
| 无植物时 | 显示引导提示 | ⬜ |
| 无任务时 | 显示空状态 | ⬜ |
| 无图片时 | 显示默认图标 | ⬜ |

### 6.4 并发操作测试

| 测试项 | 操作 | 预期结果 | 状态 |
|--------|------|----------|------|
| 快速点击按钮 | 连续点击 | 防抖处理，不重复提交 | ⬜ |
| 同时编辑多项 | 多个模态框 | 只允许一个模态框 | ⬜ |
| 快速切换标签 | 快速点击 | 正确切换，无错误 | ⬜ |

---

## 自动化测试

### 单元测试（可选）

```bash
cd frontend
npm run test
```

### E2E 测试（可选）

使用 Playwright 或 Cypress 进行端到端测试。

```bash
cd frontend
npm run test:e2e
```

---

## 测试数据准备

### 使用测试脚本快速准备数据

运行测试数据准备脚本：

```bash
cd frontend
node scripts/prepare-test-data.js
```

该脚本将创建：
- 4个不同类型的房间
- 8株不同的植物
- 多个养护配置
- 生成今日和即将到期的任务

---

## 测试检查清单

### 完整测试流程

完成以下检查清单确保系统完整可用：

#### 基础功能
- [ ] 所有页面可正常访问
- [ ] 导航菜单工作正常
- [ ] 响应式布局正常

#### 房间管理
- [ ] 创建房间成功
- [ ] 编辑房间成功
- [ ] 删除房间成功
- [ ] 房间筛选正常

#### 植物管理
- [ ] 创建植物成功
- [ ] 编辑植物成功
- [ ] 删除植物成功
- [ ] 植物搜索和筛选正常
- [ ] 图片上传和管理正常

#### 任务管理
- [ ] 任务列表正确显示
- [ ] 完成任务功能正常
- [ ] 任务筛选正常

#### 数据一致性
- [ ] 删除房间后植物关联更新
- [ ] 删除植物后图片和配置删除
- [ ] 完成任务后状态更新

---

## 常见问题排查

### 问题 1: 页面显示空白

**可能原因：**
- 后端服务未启动
- API 地址配置错误

**解决方法：**
```bash
# 检查后端服务
curl http://localhost:12801/health

# 检查前端环境变量
cat frontend/.env
```

### 问题 2: API 请求失败

**可能原因：**
- CORS 配置问题
- 端口被占用

**解决方法：**
```bash
# 检查端口占用
lsof -i :12801
lsof -i :12800

# 查看浏览器控制台错误
# 打开开发者工具 -> Network 标签
```

### 问题 3: 图片上传失败

**可能原因：**
- 文件大小超过限制
- 文件格式不支持
- uploads 目录权限问题

**解决方法：**
```bash
# 检查上传目录
ls -la backend/uploads/plants/

# 检查目录权限
chmod 755 backend/uploads/plants/
```

### 问题 4: 数据未刷新

**可能原因：**
- React Query 缓存问题
- 未正确触发重新获取

**解决方法：**
```javascript
// 在组件中手动刷新
const { refetch } = useRooms()
refetch()
```

---

## 性能测试

### 加载性能

| 指标 | 目标值 | 测试方法 |
|------|--------|----------|
| 首屏加载时间 | < 2s | 浏览器开发者工具 Performance |
| API 响应时间 | < 500ms | Network 标签 |
| 页面交互响应 | < 100ms | 用户体验测试 |

### 压力测试

```bash
# 使用 Apache Bench 测试 API
ab -n 1000 -c 10 http://localhost:12801/api/v1/rooms/
```

---

## 测试报告模板

```markdown
# 测试报告

**测试日期：** YYYY-MM-DD
**测试人员：** [姓名]
**测试环境：** [开发/测试/生产]

## 测试概况
- 总测试用例：XX
- 通过：XX
- 失败：XX
- 通过率：XX%

## 失败用例

### 用例ID: TC001
- **名称：** [用例名称]
- **步骤：** [测试步骤]
- **预期结果：** [预期结果]
- **实际结果：** [实际结果]
- **严重程度：** [高/中/低]

## 建议和改进点
1. [建议1]
2. [建议2]

## 总结
[总体评价和结论]
```

---

## 附录

### A. 测试环境配置

```bash
# .env.test.example
VITE_API_URL=http://localhost:12801/api/v1
```

### B. 快捷测试命令

```bash
# 快速启动测试环境
npm run test:setup

# 运行所有测试
npm run test:all

# 生成测试报告
npm run test:report
```

### C. 浏览器兼容性

| 浏览器 | 版本 | 状态 |
|--------|------|------|
| Chrome | 最新版 | ✅ 支持 |
| Firefox | 最新版 | ✅ 支持 |
| Safari | 最新版 | ✅ 支持 |
| Edge | 最新版 | ✅ 支持 |

---

**文档版本：** 1.0.0
**最后更新：** 2025-01-25
