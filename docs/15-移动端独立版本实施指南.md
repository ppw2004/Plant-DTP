# Plant-DTP ç§»åŠ¨ç«¯ç‹¬ç«‹ç‰ˆæœ¬å®æ–½æŒ‡å—

> **æ–‡æ¡£ç‰ˆæœ¬**: v1.0
> **åˆ›å»ºæ—¥æœŸ**: 2026-01-29
> **ç»´æŠ¤è€…**: Plant-DTP Team

---

## ğŸ“‘ ç›®å½•

- [ä¸€ã€æ–¹æ¡ˆæ¦‚è¿°](#ä¸€æ–¹æ¡ˆæ¦‚è¿°)
- [äºŒã€ç›®å½•ç»“æ„è®¾è®¡](#äºŒç›®å½•ç»“æ„è®¾è®¡)
- [ä¸‰ã€è·¯ç”±é…ç½®](#ä¸‰è·¯ç”±é…ç½®)
- [å››ã€ç§»åŠ¨ç«¯å¸ƒå±€](#å››ç§»åŠ¨ç«¯å¸ƒå±€)
- [äº”ã€é¡µé¢å®æ–½](#äº”é¡µé¢å®æ–½)
- [å…­ã€è®¾å¤‡æ£€æµ‹ä¸è‡ªåŠ¨è·³è½¬](#å…­è®¾å¤‡æ£€æµ‹ä¸è‡ªåŠ¨è·³è½¬)
- [ä¸ƒã€Nginxé…ç½®](#ä¸ƒnginxé…ç½®)
- [å…«ã€å¼€å‘ä¸æµ‹è¯•](#å…«å¼€å‘ä¸æµ‹è¯•)

---

## ä¸€ã€æ–¹æ¡ˆæ¦‚è¿°

### 1.1 è®¾è®¡ç›®æ ‡

```
æ¡Œé¢ç‰ˆ: http://82.156.213.38/
  - ä½¿ç”¨ç°æœ‰ä»£ç 
  - ä¿æŒä¸å˜
  - ä¼ ç»ŸWebå¸ƒå±€

ç§»åŠ¨ç«¯: http://82.156.213.38/mobile
  - å…¨æ–°è®¾è®¡çš„ç§»åŠ¨ç«¯UI
  - æ‰‹åŠ¿äº¤äº’ä¼˜åŒ–
  - åº•éƒ¨Tabå¯¼èˆª
  - ä¸“é—¨çš„ç§»åŠ¨ç«¯ç»„ä»¶
```

### 1.2 æ ¸å¿ƒä¼˜åŠ¿

```typescript
âœ… ä»£ç å¤ç”¨
  - APIæœåŠ¡å±‚ 100%å¤ç”¨
  - çŠ¶æ€ç®¡ç† 100%å¤ç”¨
  - Hooks 100%å¤ç”¨
  - ä¸šåŠ¡é€»è¾‘ 100%å¤ç”¨

âœ… UIç‹¬ç«‹
  - æ¡Œé¢ç‰ˆä½¿ç”¨ Ant Design
  - ç§»åŠ¨ç«¯ä½¿ç”¨ Ant Design Mobile + è‡ªå®šä¹‰
  - äº’ä¸å¹²æ‰°

âœ… ç»´æŠ¤ç®€å•
  - ä¸€ä¸ªä»£ç åº“
  - ä¸€å¥—æ„å»ºæµç¨‹
  - ä¸€å¥—éƒ¨ç½²
```

### 1.3 æŠ€æœ¯æ–¹æ¡ˆ

```typescript
// è·¯ç”±æ–¹æ¡ˆ
æ¡Œé¢ç‰ˆ: / (basename: "/")
ç§»åŠ¨ç«¯: /mobile (basename: "/mobile")

// æ„å»ºæ–¹æ¡ˆ
å•é¡µé¢åº”ç”¨ (SPA)
- æ‰€æœ‰è·¯ç”±ç”±React Routerå¤„ç†
- ä¸€ä¸ªindex.html
- ä¸€å¥—æ„å»ºäº§ç‰©

// å…±äº«å±‚
APIå±‚ã€çŠ¶æ€ç®¡ç†ã€Hooksã€å·¥å…·å‡½æ•° â†’ å®Œå…¨å¤ç”¨
UIç»„ä»¶ã€å¸ƒå±€ã€é¡µé¢ â†’ å®Œå…¨ç‹¬ç«‹
```

---

## äºŒã€ç›®å½•ç»“æ„è®¾è®¡

### 2.1 æ¨èçš„ç›®å½•é‡æ„

```bash
frontend/src/
â”œâ”€â”€ App.tsx                  # ä¸»è·¯ç”±é…ç½®
â”œâ”€â”€ main.tsx                 # åº”ç”¨å…¥å£
â”‚
â”œâ”€â”€ pages/                   # é¡µé¢ç»„ä»¶
â”‚   â”œâ”€â”€ desktop/             # æ¡Œé¢ç‰ˆé¡µé¢ï¼ˆç°æœ‰ï¼‰
â”‚   â”‚   â”œâ”€â”€ Dashboard.tsx
â”‚   â”‚   â”œâ”€â”€ Plants.tsx
â”‚   â”‚   â”œâ”€â”€ Rooms.tsx
â”‚   â”‚   â”œâ”€â”€ Tasks.tsx
â”‚   â”‚   â””â”€â”€ Settings.tsx
â”‚   â”‚
â”‚   â””â”€â”€ mobile/              # ç§»åŠ¨ç«¯é¡µé¢ï¼ˆæ–°å¢ï¼‰
â”‚       â”œâ”€â”€ MobileDashboard.tsx
â”‚       â”œâ”€â”€ MobilePlants.tsx
â”‚       â”œâ”€â”€ MobileRooms.tsx
â”‚       â”œâ”€â”€ MobileTasks.tsx
â”‚       â””â”€â”€ MobileSettings.tsx
â”‚
â”œâ”€â”€ components/              # ç»„ä»¶
â”‚   â”œâ”€â”€ desktop/             # æ¡Œé¢ç‰ˆç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ layout/
â”‚   â”‚   â”‚   â”œâ”€â”€ DesktopHeader.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ DesktopSidebar.tsx
â”‚   â”‚   â”‚   â””â”€â”€ DesktopLayout.tsx
â”‚   â”‚   â”œâ”€â”€ plant/
â”‚   â”‚   â”œâ”€â”€ room/
â”‚   â”‚   â””â”€â”€ task/
â”‚   â”‚
â”‚   â””â”€â”€ mobile/              # ç§»åŠ¨ç«¯ç»„ä»¶
â”‚       â”œâ”€â”€ layout/
â”‚       â”‚   â”œâ”€â”€ MobileHeader.tsx
â”‚       â”‚   â”œâ”€â”€ MobileTabBar.tsx
â”‚       â”‚   â””â”€â”€ MobileLayout.tsx
â”‚       â”œâ”€â”€ plant/
â”‚       â”‚   â”œâ”€â”€ MobilePlantCard.tsx
â”‚       â”‚   â””â”€â”€ MobilePlantGrid.tsx
â”‚       â”œâ”€â”€ room/
â”‚       â””â”€â”€ task/
â”‚
â”œâ”€â”€ layouts/                 # å¸ƒå±€å®¹å™¨
â”‚   â”œâ”€â”€ DesktopLayout.tsx    # æ¡Œé¢ç‰ˆå¸ƒå±€ï¼ˆç°æœ‰ï¼‰
â”‚   â””â”€â”€ MobileLayout.tsx     # ç§»åŠ¨ç«¯å¸ƒå±€ï¼ˆæ–°å¢ï¼‰
â”‚
â”œâ”€â”€ hooks/                   # å…±ç”¨Hooksï¼ˆä¸å˜ï¼‰
â”‚   â”œâ”€â”€ useDashboard.ts
â”‚   â”œâ”€â”€ usePlants.ts
â”‚   â”œâ”€â”€ useRooms.ts
â”‚   â””â”€â”€ useTasks.ts
â”‚
â”œâ”€â”€ services/                # APIæœåŠ¡ï¼ˆä¸å˜ï¼‰
â”‚   â”œâ”€â”€ api.ts
â”‚   â”œâ”€â”€ plant.ts
â”‚   â”œâ”€â”€ room.ts
â”‚   â””â”€â”€ task.ts
â”‚
â””â”€â”€ store/                   # çŠ¶æ€ç®¡ç†ï¼ˆä¸å˜ï¼‰
    â””â”€â”€ index.ts
```

### 2.2 è¿ç§»æ­¥éª¤

```bash
# Step 1: åˆ›å»ºç›®å½•ç»“æ„
mkdir -p frontend/src/pages/desktop
mkdir -p frontend/src/pages/mobile
mkdir -p frontend/src/components/desktop
mkdir -p frontend/src/components/mobile

# Step 2: ç§»åŠ¨ç°æœ‰é¡µé¢
mv frontend/src/pages/Dashboard.tsx frontend/src/pages/desktop/
mv frontend/src/pages/Plants.tsx frontend/src/pages/desktop/
mv frontend/src/pages/Rooms.tsx frontend/src/pages/desktop/
mv frontend/src/pages/Tasks.tsx frontend/src/pages/desktop/
mv frontend/src/pages/Settings.tsx frontend/src/pages/desktop/

# Step 3: æ›´æ–°å¯¼å…¥è·¯å¾„ï¼ˆå…¨å±€æ›¿æ¢ï¼‰
# ä»: import Dashboard from './pages/Dashboard'
# åˆ°: import Dashboard from './pages/desktop/Dashboard'
```

---

## ä¸‰ã€è·¯ç”±é…ç½®

### 3.1 App.tsx è·¯ç”±é…ç½®

```typescript
// frontend/src/App.tsx
import { BrowserRouter, Routes, Route, Navigate } from 'react-router-dom'
import { lazy, Suspense } from 'react'
import { Spin } from 'antd'

// æ¡Œé¢ç‰ˆå¸ƒå±€
import DesktopLayout from './layouts/DesktopLayout'

// ç§»åŠ¨ç«¯å¸ƒå±€
import MobileLayout from './layouts/MobileLayout'

// ==================== æ¡Œé¢ç‰ˆé¡µé¢ ====================
const DesktopDashboard = lazy(() => import('./pages/desktop/Dashboard'))
const DesktopPlants = lazy(() => import('./pages/desktop/Plants'))
const DesktopRooms = lazy(() => import('./pages/desktop/Rooms'))
const DesktopTasks = lazy(() => import('./pages/desktop/Tasks'))
const DesktopSettings = lazy(() => import('./pages/desktop/Settings'))

// ==================== ç§»åŠ¨ç«¯é¡µé¢ ====================
const MobileDashboard = lazy(() => import('./pages/mobile/MobileDashboard'))
const MobilePlants = lazy(() => import('./pages/mobile/MobilePlants'))
const MobileRooms = lazy(() => import('./pages/mobile/MobileRooms'))
const MobileTasks = lazy(() => import('./pages/mobile/MobileTasks'))
const MobileSettings = lazy(() => import('./pages/mobile/MobileSettings'))

// åŠ è½½æŒ‡ç¤ºå™¨
const PageLoading = () => (
  <div style={{
    height: '100vh',
    display: 'flex',
    alignItems: 'center',
    justifyContent: 'center'
  }}>
    <Spin size="large" />
  </div>
)

function App() {
  return (
    <BrowserRouter>
      <Suspense fallback={<PageLoading />}>
        <Routes>
          {/* ==================== æ¡Œé¢ç‰ˆè·¯ç”± ==================== */}
          <Route path="/" element={<DesktopLayout />}>
            <Route index element={<Navigate to="/dashboard" replace />} />
            <Route path="dashboard" element={<DesktopDashboard />} />
            <Route path="plants" element={<DesktopPlants />} />
            <Route path="plants/:id" element={<DesktopPlantDetail />} />
            <Route path="rooms" element={<DesktopRooms />} />
            <Route path="rooms/:id" element={<DesktopRoomDetail />} />
            <Route path="tasks" element={<DesktopTasks />} />
            <Route path="settings" element={<DesktopSettings />} />
          </Route>

          {/* ==================== ç§»åŠ¨ç«¯è·¯ç”± ==================== */}
          <Route path="/mobile" element={<MobileLayout />}>
            <Route index element={<Navigate to="/mobile/dashboard" replace />} />
            <Route path="dashboard" element={<MobileDashboard />} />
            <Route path="plants" element={<MobilePlants />} />
            <Route path="plants/:id" element={<MobilePlantDetail />} />
            <Route path="rooms" element={<MobileRooms />} />
            <Route path="rooms/:id" element={<MobileRoomDetail />} />
            <Route path="tasks" element={<MobileTasks />} />
            <Route path="settings" element={<MobileSettings />} />
          </Route>

          {/* ==================== 404é¡µé¢ ==================== */}
          <Route
            path="*"
            element={
              <div style={{
                height: '100vh',
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
                flexDirection: 'column',
                gap: 16
              }}>
                <h1>404 - é¡µé¢æœªæ‰¾åˆ°</h1>
                <a href="/">è¿”å›æ¡Œé¢ç‰ˆ</a>
                <a href="/mobile">è¿”å›ç§»åŠ¨ç«¯</a>
              </div>
            }
          />
        </Routes>
      </Suspense>
    </BrowserRouter>
  )
}

export default App
```

---

## å››ã€ç§»åŠ¨ç«¯å¸ƒå±€

### 4.1 MobileLayout.tsx

```typescript
// frontend/src/layouts/MobileLayout.tsx
import { Outlet, useLocation, useNavigate } from 'react-router-dom'
import { TabBar } from 'antd-mobile'
import {
  AppOutline,
  UnorderedListOutline,
  UserOutline,
  PieOutline,
} from 'antd-mobile-icons'
import { useEffect, useState } from 'react'

const TAB_BAR_ROUTES = ['/mobile/dashboard', '/mobile/plants', '/mobile/rooms', '/mobile/tasks']

export default function MobileLayout() {
  const location = useLocation()
  const navigate = useNavigate()
  const [activeKey, setActiveKey] = useState('dashboard')

  // æ ¹æ®è·¯ç”±è®¾ç½®å½“å‰Tab
  useEffect(() => {
    const path = location.pathname
    if (path.startsWith('/mobile/dashboard')) setActiveKey('dashboard')
    else if (path.startsWith('/mobile/plants')) setActiveKey('plants')
    else if (path.startsWith('/mobile/rooms')) setActiveKey('rooms')
    else if (path.startsWith('/mobile/tasks')) setActiveKey('tasks')
  }, [location.pathname])

  const tabs = [
    {
      key: 'dashboard',
      title: 'é¦–é¡µ',
      icon: <AppOutline />,
      path: '/mobile/dashboard',
    },
    {
      key: 'plants',
      title: 'æ¤ç‰©',
      icon: <UnorderedListOutline />,
      path: '/mobile/plants',
    },
    {
      key: 'rooms',
      title: 'æˆ¿é—´',
      icon: <PieOutline />,
      path: '/mobile/rooms',
    },
    {
      key: 'tasks',
      title: 'ä»»åŠ¡',
      icon: <UserOutline />,
      path: '/mobile/tasks',
    },
  ]

  // æŸäº›é¡µé¢éšè—TabBarï¼ˆå¦‚è¯¦æƒ…é¡µï¼‰
  const hideTabBar = !TAB_BAR_ROUTES.some(route =>
    location.pathname === route || location.pathname.startsWith(route + '/')
  )

  return (
    <div style={{
      height: '100vh',
      display: 'flex',
      flexDirection: 'column',
      backgroundColor: '#f5f5f5'
    }}>
      {/* é¡¶éƒ¨æ ‡é¢˜æ ï¼ˆå¯é€‰ï¼‰ */}
      {location.pathname !== '/mobile/dashboard' && (
        <div style={{
          height: 44,
          backgroundColor: '#fff',
          borderBottom: '1px solid #eee',
          display: 'flex',
          alignItems: 'center',
          justifyContent: 'center',
          fontSize: 18,
          fontWeight: 600,
        }}>
          {tabs.find(tab => tab.key === activeKey)?.title}
        </div>
      )}

      {/* ä¸»å†…å®¹åŒºåŸŸ */}
      <div style={{
        flex: 1,
        overflow: 'auto',
        paddingBottom: hideTabBar ? 0 : 50, // ä¸ºTabBarç•™å‡ºç©ºé—´
      }}>
        <Outlet />
      </div>

      {/* åº•éƒ¨TabBar */}
      {!hideTabBar && (
        <div style={{
          position: 'fixed',
          bottom: 0,
          left: 0,
          right: 0,
          backgroundColor: '#fff',
          borderTop: '1px solid #eee',
          zIndex: 1000,
        }}>
          <TabBar
            activeKey={activeKey}
            onChange={(key) => {
              const tab = tabs.find(t => t.key === key)
              if (tab) navigate(tab.path)
            }}
            safeArea
          >
            {tabs.map(tab => (
              <TabBar.Item key={tab.key} icon={tab.icon} title={tab.title} />
            ))}
          </TabBar>
        </div>
      )}
    </div>
  )
}
```

### 4.2 å®‰è£… Ant Design Mobile

```bash
# å®‰è£… antd-mobile (ç§»åŠ¨ç«¯ç»„ä»¶åº“)
npm install antd-mobile
# æˆ–
yarn add antd-mobile
# æˆ–
pnpm add antd-mobile
```

```css
/* frontend/src/index.css */
@tailwind base;
@tailwind components;
@tailwind utilities;

/* ç§»åŠ¨ç«¯ç‰¹å®šæ ·å¼ */
html, body, #root {
  height: 100%;
  margin: 0;
  padding: 0;
  -webkit-tap-highlight-color: transparent; /* ç§»é™¤ç‚¹å‡»é«˜äº® */
}

/* ç§»åŠ¨ç«¯å­—ä½“ */
body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
    'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
    sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

/* ç§»åŠ¨ç«¯æ»šåŠ¨ä¼˜åŒ– */
* {
  -webkit-overflow-scrolling: touch;
}

/* ç§»åŠ¨ç«¯æ–‡æœ¬é€‰æ‹© */
::selection {
  background: #1890ff;
  color: #fff;
}
```

---

## äº”ã€é¡µé¢å®æ–½

### 5.1 ç§»åŠ¨ç«¯é¦–é¡µ (MobileDashboard.tsx)

```typescript
// frontend/src/pages/mobile/MobileDashboard.tsx
import { Card, Grid, Typography, Space } from 'antd-mobile'
import {
  EnvironmentOutline,
  UnorderedListOutline,
  CheckCircleOutline,
  ClockCircleOutline,
} from 'antd-mobile-icons'
import { useNavigate } from 'react-router-dom'
import { useDashboardStats } from '../../hooks/useDashboard'
import { useTaskList } from '../../hooks/useTasks'

const { Title } = Typography

export default function MobileDashboard() {
  const navigate = useNavigate()
  const { data: stats, isLoading } = useDashboardStats()
  const { data: taskList } = useTaskList()

  const todayTasks = taskList?.todayTasks?.slice(0, 5) || []

  return (
    <div style={{ padding: 16, paddingBottom: 66 }}>
      {/* æ¬¢è¿ä¿¡æ¯ */}
      <Title level={4} style={{ marginBottom: 16 }}>
        ğŸ‘‹ æ¬¢è¿å›æ¥ï¼
      </Title>

      {/* ç»Ÿè®¡å¡ç‰‡ */}
      <Grid columns={2} gap={16}>
        <Grid.Item>
          <Card
            onClick={() => navigate('/mobile/rooms')}
            style={{ cursor: 'pointer' }}
          >
            <Space direction="vertical" style={{ width: '100%', textAlign: 'center' }}>
              <EnvironmentOutline fontSize={32} color="#1890ff" />
              <div style={{ fontSize: 24, fontWeight: 'bold' }}>
                {stats?.totalRooms || 0}
              </div>
              <div style={{ fontSize: 12, color: '#999' }}>æˆ¿é—´</div>
            </Space>
          </Card>
        </Grid.Item>

        <Grid.Item>
          <Card
            onClick={() => navigate('/mobile/plants')}
            style={{ cursor: 'pointer' }}
          >
            <Space direction="vertical" style={{ width: '100%', textAlign: 'center' }}>
              <UnorderedListOutline fontSize={32} color="#52c41a" />
              <div style={{ fontSize: 24, fontWeight: 'bold' }}>
                {stats?.totalPlants || 0}
              </div>
              <div style={{ fontSize: 12, color: '#999' }}>æ¤ç‰©</div>
            </Space>
          </Card>
        </Grid.Item>

        <Grid.Item>
          <Card
            onClick={() => navigate('/mobile/tasks?filter=today')}
            style={{ cursor: 'pointer' }}
          >
            <Space direction="vertical" style={{ width: '100%', textAlign: 'center' }}>
              <ClockCircleOutline fontSize={32} color="#faad14" />
              <div style={{ fontSize: 24, fontWeight: 'bold' }}>
                {taskList?.todayTasks?.length || 0}
              </div>
              <div style={{ fontSize: 12, color: '#999' }}>ä»Šæ—¥ä»»åŠ¡</div>
            </Space>
          </Card>
        </Grid.Item>

        <Grid.Item>
          <Card
            onClick={() => navigate('/mobile/tasks?filter=overdue')}
            style={{ cursor: 'pointer' }}
          >
            <Space direction="vertical" style={{ width: '100%', textAlign: 'center' }}>
              <CheckCircleOutline fontSize={32} color="#ff4d4f" />
              <div style={{ fontSize: 24, fontWeight: 'bold' }}>
                {taskList?.overdueTasks?.length || 0}
              </div>
              <div style={{ fontSize: 12, color: '#999' }}>é€¾æœŸä»»åŠ¡</div>
            </Space>
          </Card>
        </Grid.Item>
      </Grid>

      {/* ä»Šæ—¥ä»»åŠ¡ */}
      {todayTasks.length > 0 && (
        <Card title="ä»Šæ—¥ä»»åŠ¡" style={{ marginTop: 16 }}>
          <Space direction="vertical" style={{ width: '100%' }}>
            {todayTasks.map(task => (
              <div
                key={task.id}
                onClick={() => {/* è·³è½¬ä»»åŠ¡è¯¦æƒ… */}}
                style={{
                  padding: '12px 0',
                  borderBottom: '1px solid #f0f0f0',
                  cursor: 'pointer'
                }}
              >
                <div style={{ fontWeight: 500 }}>{task.title}</div>
                <div style={{ fontSize: 12, color: '#999', marginTop: 4 }}>
                  {task.plant?.name} â€¢ {task.task_type}
                </div>
              </div>
            ))}
          </Space>
        </Card>
      )}
    </div>
  )
}
```

### 5.2 ç§»åŠ¨ç«¯æ¤ç‰©åˆ—è¡¨ (MobilePlants.tsx)

```typescript
// frontend/src/pages/mobile/MobilePlants.tsx
import { useEffect, useState } from 'react'
import { AutoCenter, InfiniteScroll, SearchBar, Tag, DotLoading } from 'antd-mobile'
import { usePlants } from '../../hooks/usePlants'
import MobilePlantCard from '../../components/mobile/MobilePlantCard'

export default function MobilePlants() {
  const [page, setPage] = useState(1)
  const [hasMore, setHasMore] = useState(true)
  const [searchText, setSearchText] = useState('')

  const { plants, isLoading, fetchNextPage } = usePlants({
    page,
    search: searchText,
  })

  // åŠ è½½æ›´å¤š
  const loadMore = async () => {
    if (!hasMore || isLoading) return

    const newPage = page + 1
    setPage(newPage)

    await fetchNextPage()

    // æ£€æŸ¥æ˜¯å¦è¿˜æœ‰æ›´å¤šæ•°æ®
    if (plants.length >= 100) { // å‡è®¾æ€»å…±100æ¡
      setHasMore(false)
    }
  }

  // æœç´¢
  useEffect(() => {
    setPage(1)
    setHasMore(true)
  }, [searchText])

  return (
    <div style={{ paddingBottom: 66 }}>
      {/* æœç´¢æ  */}
      <div style={{ padding: '12px 16px', backgroundColor: '#fff', marginBottom: 8 }}>
        <SearchBar
          placeholder="æœç´¢æ¤ç‰©åç§°..."
          value={searchText}
          onChange={setSearchText}
        />
      </div>

      {/* æ¤ç‰©ç½‘æ ¼ */}
      <div style={{
        display: 'grid',
        gridTemplateColumns: 'repeat(2, 1fr)',
        gap: 12,
        padding: '0 16px',
      }}>
        {plants.map(plant => (
          <MobilePlantCard key={plant.id} plant={plant} />
        ))}
      </div>

      {/* åŠ è½½æ›´å¤š */}
      {plants.length > 0 && (
        <InfiniteScroll loadMore={loadMore} hasMore={hasMore}>
          {hasMore ? (
            <div style={{ textAlign: 'center', padding: 16 }}>
              <DotLoading />
            </div>
          ) : (
            <div style={{ textAlign: 'center', padding: 16, color: '#999' }}>
              æ²¡æœ‰æ›´å¤šäº†
            </div>
          )}
        </InfiniteScroll>
      )}

      {/* ç©ºçŠ¶æ€ */}
      {plants.length === 0 && !isLoading && (
        <AutoCenter>
          <div style={{ textAlign: 'center', marginTop: 100, color: '#999' }}>
            <div style={{ fontSize: 48 }}>ğŸŒ±</div>
            <div style={{ marginTop: 16 }}>è¿˜æ²¡æœ‰æ¤ç‰©ï¼Œå¿«å»æ·»åŠ å§ï¼</div>
          </div>
        </AutoCenter>
      )}
    </div>
  )
}
```

### 5.3 ç§»åŠ¨ç«¯æ¤ç‰©å¡ç‰‡

```typescript
// frontend/src/components/mobile/MobilePlantCard.tsx
import { Card, Image, Tag } from 'antd-mobile'
import { useNavigate } from 'react-router-dom'

interface Plant {
  id: number
  name: string
  location?: string
  primary_image?: {
    thumbnail_url: string
  }
  needs_watering?: boolean
  needs_fertilizing?: boolean
}

interface MobilePlantCardProps {
  plant: Plant
}

export default function MobilePlantCard({ plant }: MobilePlantCardProps) {
  const navigate = useNavigate()

  return (
    <Card
      onClick={() => navigate(`/mobile/plants/${plant.id}`)}
      style={{
        padding: 0,
        overflow: 'hidden',
        borderRadius: 8,
        boxShadow: '0 2px 8px rgba(0,0,0,0.08)',
      }}
      bodyStyle={{ padding: 0 }}
    >
      {/* å›¾ç‰‡ */}
      <div style={{
        width: '100%',
        aspectRatio: '1',
        overflow: 'hidden',
        backgroundColor: '#f5f5f5'
      }}>
        <Image
          src={plant.primary_image?.thumbnail_url}
          alt={plant.name}
          fit="cover"
          width="100%"
          height="100%"
          placeholder={
            <div style={{
              width: '100%',
              height: '100%',
              display: 'flex',
              alignItems: 'center',
              justifyContent: 'center',
              fontSize: 48,
            }}>
              ğŸŒ±
            </div>
          }
        />
      </div>

      {/* ä¿¡æ¯ */}
      <div style={{ padding: 12 }}>
        {/* åç§° */}
        <div style={{
          fontSize: 16,
          fontWeight: 600,
          marginBottom: 8,
          overflow: 'hidden',
          textOverflow: 'ellipsis',
          whiteSpace: 'nowrap',
        }}>
          {plant.name}
        </div>

        {/* ä½ç½® */}
        {plant.location && (
          <div style={{
            fontSize: 12,
            color: '#666',
            marginBottom: 8,
          }}>
            ğŸ“ {plant.location}
          </div>
        )}

        {/* æ ‡ç­¾ */}
        <div style={{ display: 'flex', gap: 4, flexWrap: 'wrap' }}>
          {plant.needs_watering && (
            <Tag color="primary" style={{ fontSize: 10 }}>
              éœ€æµ‡æ°´
            </Tag>
          )}
          {plant.needs_fertilizing && (
            <Tag color="success" style={{ fontSize: 10 }}>
              éœ€æ–½è‚¥
            </Tag>
          )}
        </div>
      </div>
    </Card>
  )
}
```

---

## å…­ã€è®¾å¤‡æ£€æµ‹ä¸è‡ªåŠ¨è·³è½¬

### 6.1 è®¾å¤‡æ£€æµ‹å·¥å…·

```typescript
// frontend/src/utils/device.ts

/**
 * æ£€æµ‹æ˜¯å¦ä¸ºç§»åŠ¨è®¾å¤‡
 */
export const isMobileDevice = (): boolean => {
  if (typeof window === 'undefined') return false

  const userAgent = navigator.userAgent

  // ç§»åŠ¨è®¾å¤‡å…³é”®è¯
  const mobileKeywords = [
    'Android',
    'iPhone',
    'iPad',
    'iPod',
    'BlackBerry',
    'Windows Phone',
    'webOS',
  ]

  return mobileKeywords.some(keyword => userAgent.includes(keyword))
}

/**
 * æ£€æµ‹å±å¹•å®½åº¦
 */
export const getScreenWidth = (): number => {
  if (typeof window === 'undefined') return 1024
  return window.innerWidth
}

/**
 * æ£€æµ‹æ˜¯å¦åº”è¯¥ä½¿ç”¨ç§»åŠ¨ç«¯
 */
export const shouldUseMobile = (): boolean => {
  // æ–¹æ³•1: User-Agentæ£€æµ‹
  if (isMobileDevice()) return true

  // æ–¹æ³•2: å±å¹•å®½åº¦æ£€æµ‹
  if (getScreenWidth() < 768) return true

  return false
}

/**
 * è·å–å½“å‰åº”è¯¥ä½¿ç”¨çš„URL
 */
export const getPreferredUrl = (currentPath: string): string => {
  const isMobile = shouldUseMobile()

  // å¦‚æœå·²ç»åœ¨/mobileè·¯å¾„ä¸‹ï¼Œä¸åšå¤„ç†
  if (currentPath.startsWith('/mobile')) {
    return currentPath
  }

  // å¦‚æœæ˜¯ç§»åŠ¨è®¾å¤‡ï¼Œä¸”ä¸åœ¨/mobileè·¯å¾„ï¼Œé‡å®šå‘åˆ°/mobile
  if (isMobile) {
    // ä¿æŒè·¯å¾„ç»“æ„
    if (currentPath === '/') {
      return '/mobile'
    }
    return `/mobile${currentPath}`
  }

  return currentPath
}
```

### 6.2 è‡ªåŠ¨è·³è½¬ç»„ä»¶

```typescript
// frontend/src/components/DeviceRedirect.tsx
import { useEffect } from 'react'
import { useLocation, useNavigate } from 'react-router-dom'
import { shouldUseMobile, getPreferredUrl } from '../utils/device'

interface DeviceRedirectProps {
  /**
   * æ˜¯å¦å¯ç”¨è‡ªåŠ¨è·³è½¬
   * @default true
   */
  enable?: boolean

  /**
   * ç”¨æˆ·æ˜¯å¦æ‰‹åŠ¨é€‰æ‹©è¿‡ç‰ˆæœ¬
   */
  userPreference?: 'desktop' | 'mobile' | null
}

/**
 * è®¾å¤‡æ£€æµ‹å’Œè‡ªåŠ¨è·³è½¬ç»„ä»¶
 *
 * ä½¿ç”¨æ–¹å¼ï¼š
 * 1. è‡ªåŠ¨è·³è½¬ï¼ˆé»˜è®¤ï¼‰ï¼šæ ¹æ®è®¾å¤‡è‡ªåŠ¨è·³è½¬åˆ°å¯¹åº”ç‰ˆæœ¬
 * 2. æ‰‹åŠ¨é€‰æ‹©ï¼šç”¨æˆ·æ‰‹åŠ¨é€‰æ‹©åï¼Œä¿å­˜åˆ°localStorageï¼Œä¸å†è‡ªåŠ¨è·³è½¬
 */
export default function DeviceRedirect({
  enable = true,
  userPreference,
}: DeviceRedirectProps) {
  const location = useLocation()
  const navigate = useNavigate()

  useEffect(() => {
    if (!enable) return

    // å¦‚æœç”¨æˆ·æœ‰åå¥½è®¾ç½®ï¼Œå°Šé‡ç”¨æˆ·é€‰æ‹©
    if (userPreference) {
      return
    }

    // é¦–æ¬¡è®¿é—®ï¼Œæ ¹æ®è®¾å¤‡ç±»å‹è·³è½¬
    const preferredUrl = getPreferredUrl(location.pathname)
    const currentUrl = location.pathname

    if (preferredUrl !== currentUrl) {
      navigate(preferredUrl, { replace: true })
    }
  }, [location.pathname, enable, userPreference, navigate])

  return null
}
```

### 6.3 åœ¨App.tsxä¸­ä½¿ç”¨

```typescript
// frontend/src/App.tsx
import { useEffect, useState } from 'react'
import { BrowserRouter, Routes, Route, Navigate } from 'react-router-dom'
import DeviceRedirect from './components/DeviceRedirect'

function App() {
  // è·å–ç”¨æˆ·çš„ç‰ˆæœ¬åå¥½
  const [userPreference, setUserPreference] = useState<'desktop' | 'mobile' | null>(() => {
    return localStorage.getItem('version_preference') as any
  })

  return (
    <BrowserRouter>
      {/* è®¾å¤‡æ£€æµ‹å’Œè‡ªåŠ¨è·³è½¬ */}
      <DeviceRedirect
        enable={!userPreference} // ç”¨æˆ·æœªæ‰‹åŠ¨é€‰æ‹©æ—¶æ‰è‡ªåŠ¨è·³è½¬
        userPreference={userPreference}
      />

      <Routes>
        {/* æ¡Œé¢ç‰ˆè·¯ç”± */}
        <Route path="/" element={<DesktopLayout />}>
          {/* ... */}
        </Route>

        {/* ç§»åŠ¨ç«¯è·¯ç”± */}
        <Route path="/mobile" element={<MobileLayout />}>
          {/* ... */}
        </Route>
      </Routes>
    </BrowserRouter>
  )
}
```

### 6.4 ç‰ˆæœ¬åˆ‡æ¢æŒ‰é’®

```typescript
// frontend/src/components/VersionSwitcher.tsx
import { useLocation, useNavigate } from 'react-router-dom'
import { Button, Space } from 'antd-mobile'
import { LaptopOutline, AppOutline } from 'antd-mobile-icons'

/**
 * ç‰ˆæœ¬åˆ‡æ¢ç»„ä»¶
 * ç”¨æˆ·å¯ä»¥æ‰‹åŠ¨åˆ‡æ¢åˆ°æ¡Œé¢ç‰ˆæˆ–ç§»åŠ¨ç‰ˆ
 */
export default function VersionSwitcher() {
  const location = useLocation()
  const navigate = useNavigate()

  const isMobile = location.pathname.startsWith('/mobile')

  const handleSwitch = (version: 'desktop' | 'mobile') => {
    // ä¿å­˜ç”¨æˆ·åå¥½
    localStorage.setItem('version_preference', version)

    // è®¡ç®—ç›®æ ‡è·¯å¾„
    let targetPath: string
    if (version === 'mobile') {
      // åˆ‡æ¢åˆ°ç§»åŠ¨ç«¯
      if (location.pathname === '/') {
        targetPath = '/mobile'
      } else {
        targetPath = '/mobile' + location.pathname
      }
    } else {
      // åˆ‡æ¢åˆ°æ¡Œé¢ç‰ˆ
      if (location.pathname.startsWith('/mobile')) {
        targetPath = location.pathname.replace('/mobile', '') || '/'
      } else {
        targetPath = location.pathname
      }
    }

    navigate(targetPath, { replace: true })
    window.location.reload() // åˆ·æ–°ä»¥åº”ç”¨æ–°çš„å¸ƒå±€
  }

  return (
    <div style={{
      position: 'fixed',
      bottom: 16,
      right: 16,
      zIndex: 9999,
    }}>
      <Space>
        <Button
          size="small"
          color={isMobile ? 'default' : 'primary'}
          onClick={() => handleSwitch('desktop')}
        >
          <LaptopOutline />
          æ¡Œé¢ç‰ˆ
        </Button>
        <Button
          size="small"
          color={isMobile ? 'primary' : 'default'}
          onClick={() => handleSwitch('mobile')}
        >
          <AppOutline />
          ç§»åŠ¨ç«¯
        </Button>
      </Space>
    </div>
  )
}
```

---

## ä¸ƒã€Nginxé…ç½®

### 7.1 æœåŠ¡å™¨é…ç½®

```nginx
# /etc/nginx/sites-available/plant-dtp

server {
    listen 80;
    server_name 82.156.213.38;

    # å¼ºåˆ¶HTTPSï¼ˆå¯é€‰ï¼‰
    # return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name 82.156.213.38;

    # SSLè¯ä¹¦é…ç½®
    ssl_certificate /etc/ssl/certs/plant-dtp.crt;
    ssl_certificate_key /etc/ssl/private/plant-dtp.key;

    # å‰ç«¯é™æ€æ–‡ä»¶
    location / {
        root /var/www/plant-dtp/frontend/dist;
        try_files $uri $uri/ /index.html;

        # SPAè·¯ç”±æ”¯æŒ
        # æ‰€æœ‰è·¯ç”±éƒ½è¿”å›index.htmlï¼Œç”±React Routerå¤„ç†
    }

    # APIä»£ç†
    location /api/ {
        proxy_pass http://localhost:12801/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }

    # ä¸Šä¼ æ–‡ä»¶
    location /uploads/ {
        alias /path/to/uploads/;
        expires 30d;
    }

    # Gzipå‹ç¼©
    gzip on;
    gzip_vary on;
    gzip_min_length 1024;
    gzip_types text/plain text/css application/json application/javascript text/xml application/xml;
}
```

### 7.2 å…³é”®ç‚¹è¯´æ˜

```nginx
# âœ… å…³é”®é…ç½®ï¼šSPAè·¯ç”±æ”¯æŒ
location / {
    root /var/www/plant-dtp/frontend/dist;
    try_files $uri $uri/ /index.html;  # æ‰€æœ‰è·¯ç”±éƒ½è¿”å›index.html
}

# è¿™ä¸ªé…ç½®ç¡®ä¿ï¼š
# - è®¿é—® http://82.156.213.38/ â†’ è¿”å›æ¡Œé¢ç‰ˆ
# - è®¿é—® http://82.156.213.38/mobile â†’ è¿”å›ç§»åŠ¨ç«¯
# - åˆ·æ–°é¡µé¢æ—¶ä¸ä¼šå‡ºç°404
# - React Routerå¯ä»¥æ­£ç¡®å¤„ç†æ‰€æœ‰è·¯ç”±
```

---

## å…«ã€å¼€å‘ä¸æµ‹è¯•

### 8.1 æœ¬åœ°å¼€å‘

```bash
# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
cd frontend
npm run dev

# è®¿é—®åœ°å€
# æ¡Œé¢ç‰ˆ: http://localhost:12800/
# ç§»åŠ¨ç«¯: http://localhost:12800/mobile
```

### 8.2 çœŸæœºæµ‹è¯•

```bash
# æ–¹æ³•1: ä½¿ç”¨å†…ç½‘ç©¿é€
# 1. å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev

# 2. å¯åŠ¨å†…ç½‘ç©¿é€ï¼ˆå¦‚NATAPPï¼‰
./natapp -authtoken=YOUR_TOKEN

# 3. æ‰‹æœºè®¿é—®
# https://xxx.natappfree.cc/          # æ¡Œé¢ç‰ˆ
# https://xxx.natappfree.cc/mobile   # ç§»åŠ¨ç«¯
```

### 8.3 æ„å»ºä¸éƒ¨ç½²

```bash
# æ„å»ºå‰ç«¯
cd frontend
npm run build

# éƒ¨ç½²åˆ°æœåŠ¡å™¨
rsync -avz dist/ user@82.156.213.38:/var/www/plant-dtp/frontend/dist/

# é‡å¯Nginx
ssh user@82.156.213.38 "sudo systemctl reload nginx"
```

### 8.4 æµ‹è¯•æ¸…å•

```typescript
// æ¡Œé¢ç‰ˆæµ‹è¯•
âœ… http://82.156.213.38/ â†’ æ˜¾ç¤ºæ¡Œé¢ç‰ˆå¸ƒå±€
âœ… ä¾§è¾¹æ æ­£å¸¸æ˜¾ç¤º
âœ… ç‚¹å‡»å¯¼èˆªæ­£å¸¸è·³è½¬
âœ… åˆ·æ–°é¡µé¢ä¸ä¼š404

// ç§»åŠ¨ç«¯æµ‹è¯•
âœ… http://82.156.213.38/mobile â†’ æ˜¾ç¤ºç§»åŠ¨ç«¯å¸ƒå±€
âœ… åº•éƒ¨TabBaræ­£å¸¸æ˜¾ç¤º
âœ… ç‚¹å‡»Tabæ­£å¸¸åˆ‡æ¢
âœ… åˆ·æ–°é¡µé¢ä¸ä¼š404

// è‡ªåŠ¨è·³è½¬æµ‹è¯•
âœ… æ‰‹æœºè®¿é—® / â†’ è‡ªåŠ¨è·³è½¬åˆ° /mobile
âœ… ç”µè„‘è®¿é—® /mobile â†’ å¯é€‰æ‹©è·³è½¬åˆ° /
âœ… ç”¨æˆ·æ‰‹åŠ¨é€‰æ‹©åï¼Œä¸å†è‡ªåŠ¨è·³è½¬

// è·¨ç‰ˆæœ¬è·³è½¬æµ‹è¯•
âœ… ä» /plants è·³è½¬åˆ° /mobile/plants
âœ… ä» /mobile/plants è·³è½¬åˆ° /plants
âœ… è·¯å¾„å‚æ•°æ­£ç¡®ä¿ç•™ï¼ˆå¦‚ /plants/123 â†’ /mobile/plants/123ï¼‰
```

---

## ä¹ã€å¼€å‘è®¡åˆ’

### Week 1: åŸºç¡€è®¾æ–½æ­å»º

```bash
Day 1-2: ç›®å½•ç»“æ„é‡æ„
- åˆ›å»º pages/desktop å’Œ pages/mobile
- ç§»åŠ¨ç°æœ‰é¡µé¢åˆ°å¯¹åº”ç›®å½•
- æ›´æ–°æ‰€æœ‰å¯¼å…¥è·¯å¾„

Day 3-4: è·¯ç”±é…ç½®
- é…ç½®åŒè·¯ç”±ç³»ç»Ÿ
- åˆ›å»º MobileLayout
- å®ç°åº•éƒ¨TabBar

Day 5: è®¾å¤‡æ£€æµ‹
- å®ç°è®¾å¤‡æ£€æµ‹å·¥å…·
- å®ç°è‡ªåŠ¨è·³è½¬é€»è¾‘
- å®ç°ç‰ˆæœ¬åˆ‡æ¢æŒ‰é’®
```

### Week 2: æ ¸å¿ƒé¡µé¢å¼€å‘

```bash
Day 1-2: MobileDashboard
- ç»Ÿè®¡å¡ç‰‡
- ä»Šæ—¥ä»»åŠ¡åˆ—è¡¨

Day 3-4: MobilePlants
- æ¤ç‰©ç½‘æ ¼
- æœç´¢åŠŸèƒ½
- æ— é™æ»šåŠ¨

Day 5: MobileTasks
- ä»»åŠ¡åˆ—è¡¨
- æ»‘åŠ¨æ“ä½œ
```

### Week 3: å®Œå–„ä¸æµ‹è¯•

```bash
Day 1-2: å…¶ä»–é¡µé¢
- MobileRooms
- MobileSettings

Day 3-4: æµ‹è¯•ä¸ä¿®å¤
- çœŸæœºæµ‹è¯•
- Bugä¿®å¤

Day 5: éƒ¨ç½²ä¸Šçº¿
- æ„å»ºç”Ÿäº§ç‰ˆæœ¬
- éƒ¨ç½²åˆ°æœåŠ¡å™¨
- éªŒè¯åŠŸèƒ½
```

---

## åã€å¸¸è§é—®é¢˜

### Q1: ç§»åŠ¨ç«¯å’Œæ¡Œé¢ç‰ˆæ˜¯å¦å¯ä»¥å…±äº«APIï¼Ÿ

**A:** å¯ä»¥ï¼APIå±‚å®Œå…¨å…±äº«ï¼š

```typescript
// hooks/usePlants.ts - æ¡Œé¢ç‰ˆå’Œç§»åŠ¨ç‰ˆå…±ç”¨
export const usePlants = (params?) => {
  return useQuery({
    queryKey: ['plants', params],
    queryFn: () => fetchPlants(params),  // åŒä¸€ä¸ªAPI
  })
}
```

### Q2: å¦‚ä½•åœ¨ç§»åŠ¨ç«¯å’Œæ¡Œé¢ç‰ˆä¹‹é—´è·³è½¬ï¼Ÿ

**A:** ä½¿ç”¨React Routerçš„Linkï¼š

```typescript
import { Link } from 'react-router-dom'

// ä»æ¡Œé¢ç‰ˆè·³è½¬åˆ°ç§»åŠ¨ç«¯
<Link to="/mobile/plants">æŸ¥çœ‹ç§»åŠ¨ç‰ˆ</Link>

// ä»ç§»åŠ¨ç«¯è·³è½¬åˆ°æ¡Œé¢ç‰ˆ
<Link to="/plants">æŸ¥çœ‹æ¡Œé¢ç‰ˆ</Link>
```

### Q3: å¦‚ä½•å¤„ç†ç§»åŠ¨ç«¯å’Œæ¡Œé¢ç‰ˆçš„æ ·å¼å†²çªï¼Ÿ

**A:** ä½¿ç”¨ç‹¬ç«‹çš„ç»„ä»¶ï¼Œé¿å…å†²çªï¼š

```typescript
// âŒ ä¸æ¨èï¼šåŒä¸€ä¸ªç»„ä»¶å†…åˆ¤æ–­è®¾å¤‡
const MyComponent = () => {
  const isMobile = useIsMobile()
  return isMobile ? <MobileUI /> : <DesktopUI />
}

// âœ… æ¨èï¼šå®Œå…¨ç‹¬ç«‹çš„ç»„ä»¶
// pages/desktop/Plants.tsx - æ¡Œé¢ç‰ˆ
// pages/mobile/MobilePlants.tsx - ç§»åŠ¨ç«¯
```

### Q4: ç”¨æˆ·æ‰‹åŠ¨é€‰æ‹©ç‰ˆæœ¬åï¼Œå¦‚ä½•è®°ä½é€‰æ‹©ï¼Ÿ

**A:** ä½¿ç”¨localStorageï¼š

```typescript
// ä¿å­˜ç”¨æˆ·é€‰æ‹©
localStorage.setItem('version_preference', 'mobile')

// è¯»å–ç”¨æˆ·é€‰æ‹©
const userPreference = localStorage.getItem('version_preference')

// æ¸…é™¤é€‰æ‹©ï¼ˆæ¢å¤è‡ªåŠ¨è·³è½¬ï¼‰
localStorage.removeItem('version_preference')
```

### Q5: ç§»åŠ¨ç«¯éœ€è¦PWAå—ï¼Ÿ

**A:** ç§»åŠ¨ç«¯(/mobile)å¯ä»¥å•ç‹¬é…ç½®PWAï¼š

```typescript
// vite.config.ts
VitePWA({
  includeAssets: ['manifest.json'],
  manifest: {
    name: 'Plant-DTP Mobile',
    start_url: '/mobile',  // ç§»åŠ¨ç«¯çš„èµ·å§‹URL
    // ...
  }
})
```

---

**ä¸‹ä¸€æ­¥è¡ŒåŠ¨ï¼š**

1. âœ… åˆ›å»º feature/mobile åˆ†æ”¯
2. âœ… é‡æ„ç›®å½•ç»“æ„
3. âœ… é…ç½®åŒè·¯ç”±ç³»ç»Ÿ
4. âœ… å¼€å‘ç¬¬ä¸€ä¸ªç§»åŠ¨ç«¯é¡µé¢
5. âœ… æµ‹è¯•éƒ¨ç½²

**é¢„è®¡å·¥æœŸ**: 3å‘¨

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**æ›´æ–°æ—¥æœŸ**: 2026-01-29
